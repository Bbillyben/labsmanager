{% extends "base.html" %}
{% load i18n %}
{% load static %}
{% load customs_tags %}

{% block page_title %}
{% trans "LabManager Employee" %}
{% endblock %}

{% block breadcrumb_list %}
{% endblock %}

{% block sidebar %}

{% endblock %}

{% block content %}
{% include 'modals.html' with modal_id='create-modal' modal_title='Employee' %}

<div id='detail-panels'>
    <div class="panel panel-hidden panel-visible" id="panel-stock" style="display: block;">

        <div class="panel-heading">
            <div class="d-flex flex-wrap">
                <h4>{% trans 'Employee' %} : {{ employee }}</h4>
                <span class="flex" style="flex-grow: 1;"></span>
                {% if perms.staff.can_change %}
                <div class="btn-group" role="group">
                    <button id="employee-options" class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" title="Employee Actions" aria-expanded="false">
                        <i class="fas fa-flask"></i>
                    </button>
                    <ul class="dropdown-menu" style="">
                        <li><a class="dropdown-item" href="#" id="edit-employee" title="Edit Employee">
                            <i class='fa fa-edit'></i> {% trans 'Edit Employee' %}
                        </a></li>
                        <li><a class="dropdown-item" href="#" id="add-status" title="Edit Employee">
                            <i class='fa fa-user-plus'></i> {% trans 'Add Status' %}
                        </a></li>
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>
        <div class="panel-content">
            <div class="container" style="max-width: 100%; padding: 5px;">
                <div class="row">
                    <div class="col" id="detail-panel-left">
                    <div class="card">
                        <div class="row">
                            <div class="col">
                                <table class="table table-striped table-condensed" id="employee_single_table">
                                    <colgroup>
                                        <col width="25">
                                    </colgroup>
                                    <tbody>
                                        <tr>
                                            <td><i class="fas fa-id-card"></i></td>
                                            <td>{% trans 'Employee Id' %}</td>
                                            <td>{{employee.user.first_name }} {{employee.user.last_name }}</td>
                                        </tr>
                                        <tr>
                                            <td><i class="fas fa-birthday-cake"></i></td>
                                            <td>{% trans 'Birth Date' %}</td>
                                            <td>{% firstof employee.birth_date "-"  %}</td>
                                        </tr>
                                        <tr>
                                            <td><i class="fas fa-calendar-plus"></i></td>
                                            <td>{% trans 'Entree Date' %}</td>
                                            <td>{% firstof employee.entry_date "-"  %}</td>
                                        </tr>
                                        <tr>
                                            <td><i class="fas fa-calendar-minus"></i></td>
                                            <td>{% trans 'Exit Date' %}</td>
                                            <td>{% firstof employee.exit_date "-"  %}</td>
                                        </tr>
                                        <tr>
                                            <td><i class="fas fa-user"></i></td>
                                            <td>{% trans 'Active' %}</td>
                                            <td>
                                                {% if perms.user.can_change %}
                                                    <span type="button" class="user_action" data-action-type="activate_user_{{ employee.is_active|yesno:'false,true' }}" data-pk="{{ employee.user.pk }}" data-url="{% url 'ajax_staff' %}" >
                                                    {% if employee.is_active %}
                                                        <i class="fa fa-toggle-off" aria-hidden="true" style="color:green"></i>
                                                    {% else %}
                                                    <i class="fa fa-toggle-on" aria-hidden="true" style="color:red"></i>
                                                    {% endif %}
                                                    </span>
                                                {% else %}
                                                    {% if employee.is_active %}
                                                        <img src="/static/admin/img/icon-yes.svg" alt="True">
                                                    {% else %}
                                                        <img src="/static/admin/img/icon-no.svg" alt="False">
                                                    {% endif %}
                                                {% endif %}
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="col" id="detail-panel-right">
                    <div class="card">
                        <div class="row">
                            <div class="col">
                                <table
                                    class='table table-striped table-condensed'
                                    id="employee_status_table"
                                    data-id-table="statusTable"
                                    data-url="/api/employee/{{ employee.pk }}/status/"
                                    >
                                    <thead class="">
                                        <tr>
                                            <th data-sortable="true" class="th-inner sortable both" data-field="type.name" >
                                                {% trans 'Status' %}
                                            </th>
                                            <th data-sortable="true" class="th-inner sortable both" data-field="type.shortname">
                                                {% trans 'Status abb' %}
                                            </th>
                                            <th data-sortable="true" class="th-inner sortable both" data-field="start_date">
                                                {% trans 'Start Date' %}
                                            </th>
                                            <th data-sortable="true" class="th-inner sortable both" data-field="end_date">
                                                {% trans 'End Date' %}
                                            </th>
                                            {% if perms.staff.can_change %}
                                            <th data-sortable="false" class="th-inner" data-field="admin_action" data-user="{{ request.user.id }}"  data-formatter="empStatusFormatter">
                                                {% trans 'Action' %}
                                            </th>
                                            {% endif %}
                                        </tr>
                                    </thead>
                                    <tbody>

                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>
                </div>
                
                
            </div> <!-- container # 1-->
            <div class="container" style="max-width: 100%; padding: 5px;">
                <div class="row">
                    <div class="row-header">
                         <h4><i class="fas fa-file-contract"></i>  {% trans 'Contracts' %}</h4>
                    </div>
                </div>
                <div class="row">
                    <table
                    class='table table-striped table-condensed'
                    id="employee_contract_table"
                    data-id-table="contractTable"
                    data-url="/api/employee/{{ employee.pk }}/contracts/"
                    >
                    <thead class="">
                        <tr>
                            <th data-sortable="true" class="th-inner sortable both" data-field="fund.project.name" >
                                {% trans 'Project' %}
                            </th>
                            <th data-sortable="true" class="th-inner sortable both" data-field="fund.funder.name">
                                {% trans 'Funder' %}
                            </th>
                            <th data-sortable="true" class="th-inner sortable both" data-field="start_date">
                                {% trans 'Start Date' %}
                            </th>
                            <th data-sortable="true" class="th-inner sortable both" data-field="end_date">
                                {% trans 'End Date' %}
                            </th>
                            <th data-sortable="true" class="th-inner sortable both" data-field="fund.institution.short_name">
                                {% trans 'Institution' %}
                            </th>
                            <th data-sortable="true" class="th-inner sortable both" data-field="quotity" data-formatter="quotityFormatter">
                                {% trans 'Quotity' %}
                            </th>
                            {% if perms.staff.can_change %}
                            <th data-sortable="false" class="th-inner" data-field="admin_action" >
                                {% trans 'Action' %}
                            </th>
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>

                </div>
                

            </div>
            <div class="container" style="max-width: 100%; padding: 5px;">
                <div class="row">
                    <div class="row-header">
                        <h4><i class="fas fa-users"></i>  {% trans 'Teams' %}</h4>
                    </div>
                </div>
                <div class="row">
                    <table
                    class='table table-striped table-condensed'
                    id="employee_team_table"
                    data-id-table="teamTable"
                    data-url="/api/employee/{{ employee.pk }}/teams/"
                    >
                    <thead class="">
                        <tr>
                            <th data-sortable="true" class="th-inner sortable both" data-field="name" >
                                {% trans 'Team Name' %}
                            </th>
                            <th data-sortable="true" class="th-inner sortable both" data-field="leader.user_name">
                                {% trans 'Leader' %}
                            </th>
                            <th data-sortable="true" class="th-inner sortable both" data-field="team_mate" data-formatter="teamMateFormatter">
                                {% trans 'Team Mate' %}
                            </th>
                            {% if perms.staff.can_change %}
                            <th data-sortable="false" class="th-inner" data-field="admin_action" >
                                {% trans 'Action' %}
                            </th>
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>

                </div>
                

            </div>
            
        </div>

    </div>
</div>

{{ request.user.id|json_script:"user_id" }}
{{ employee.pk|json_script:"employee_id" }}
{% endblock %}



{% block js_load %}
<script type='text/javascript' src="{% static 'js/employee_single.js' %}"></script>
<script>
$(document).ready(function () {
    user_id = JSON.parse(document.getElementById('user_id').textContent);
    employee_id = JSON.parse(document.getElementById('employee_id').textContent);
    initEmployeeSingleView(user_id, employee_id);
})
</script>

{% endblock %}

{% block js %}
{% endblock %}