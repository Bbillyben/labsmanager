{% extends "base.html" %}
{% load i18n %}
{% load static %}
{% load customs_tags %}

{% block page_title %}
{% trans "LabManager Employee" %}
{% endblock %}

{% block breadcrumb_list %}
{% endblock %}

{% block sidebar %}
    {% include 'project/project_sidebar.html' %}
{% endblock %}

{% block content %}
{% include 'modals.html' with modal_id='create-modal' modal_title='Project' %}


<div id='detail-panels'>
    <div class="panel" id="panel-project" style="display: block;">

        <div class="panel-heading">
            <div class="d-flex flex-wrap">
                <h4>{% trans 'Project' %} : {{ project }}</h4>
                <span class="flex" style="flex-grow: 1;"></span>
                
                <div class="btn-group" role="group">

                    {% if perms.project.change_project or perms.project.add_participant or perms.project.add_institution_participant%}
                    {% if request.user.is_staff %}
                    <a href='{% url "admin:project_project_change" project.pk %}'><button class='icon admin_employee btn btn-secondary'><i type = 'button' class='fas fa-shield-halved'></i></button></a>
                    {% endif %}
                    
                    <button id="project-options" class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown" title="Project Actions" aria-expanded="false">
                        <i class="fas fa-flask"></i>
                    </button>
                    <ul class="dropdown-menu" style="">
                        {% if perms.project.change_project %}
                        <li><a class="dropdown-item" href="#" id="edit-project" title="Edit Project">
                            <i class='fa fa-edit'></i> {% trans 'Edit Project' %}
                        </a></li>
                        {% endif %}
                        {% if perms.project.add_participant %}
                        <li><a class="dropdown-item" href="#" id="add_participant" title="Add Participant">
                            <i class='fa fa-user-plus'></i> {% trans 'Add Participant' %}
                        </a></li>
                        {% endif %}
                        {% if perms.project.add_institution_participant %}
                        <li><a class="dropdown-item" href="#" id="add_institution_participant" title="Add Institution">
                            <i class='fa fa-building-columns'></i> {% trans 'Add Institution' %}
                        </a></li>
                        {% endif %}
                    </ul>
                    {% endif %}
                </div>
                
            </div>
        </div>
        <div class="panel-content">
            <div class="container" style="max-width: 100%; padding: 5px;">
                <div class="row">
                    <div class="col" id="detail-panel-left">
                        <div class="card">
                            <div class="row">
                                <div class="col" id="project_desc_table">
                                    <!-- project description table inserted here -->

                                </div>
                            </div>
                        </div>
                    </div>
                <div class="col" id="detail-panel-center">
                    <div class="card">

                    
                        <div class="d-flex flex-wrap subheading">
                            <h4><i class="fas fa-money-bills"></i>  {% trans 'Institutions' %} </h4> 
                        </div>
                        <table
                            class='table table-striped table-condensed'
                            id="project_institution_table"
                            data-id-table="institutionTable"
                            data-url="/api/project/{{ project.pk }}/institution/"
                            >
                            <thead class="">
                                <tr>
                                    <th data-sortable="true" class="th-inner sortable both" data-field="institution.short_name"  data-formatter="">
                                        {% trans 'Institutions' %}
                                    </th>
                                    <th data-sortable="true" class="th-inner sortable both" data-field="status_name">
                                        {% trans 'Status' %}
                                    </th>
                                    
                                </tr>
                            </thead>
                            <tbody>

                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col" id="detail-panel-right">
                    <div class="card">
                        
                            <div class="col">
                                <div class="d-flex flex-wrap subheading">
                                    <h4><i class="fas fa-money-bills"></i>  {% trans 'Participant' %} </h4> 
                                </div>
                                <table
                                    class='table table-striped table-condensed'
                                    id="project_participant_table"
                                    data-id-table="statusTable"
                                    data-url="/api/project/{{ project.pk }}/participant/"
                                    >
                                    <thead class="">
                                        <tr>
                                            <th data-sortable="true" class="th-inner sortable both" data-field="employee"  data-formatter="teamMateFormatter">
                                                {% trans 'Employee' %}
                                            </th>
                                            <th data-sortable="true" class="th-inner sortable both" data-field="status_name">
                                                {% trans 'Status' %}
                                            </th>
                                            <th data-sortable="true" class="th-inner sortable both" data-field="quotity" data-formatter="quotityFormatter">
                                                {% trans 'Quotity' %}
                                            </th>
                                            <th data-sortable="true" class="th-inner sortable both" data-field="start_date">
                                                {% trans 'Start Date' %}
                                            </th>
                                            <th data-sortable="true" class="th-inner sortable both" data-field="end_date">
                                                {% trans 'End Date' %}
                                            </th>
                                            <th data-sortable="true" class="th-inner sortable both" data-field="employee.is_active" data-formatter="basicBoolean" data-cell-style="styleAlignMiddle" >
                                                {% trans 'Employee Active' %}
                                            </th>
                                            {% if perms.project.change_participant or perms.project.delete_participant %}
                                            <th data-sortable="false" class="th-inner" data-field="admin_action" data-formatter="adminActionParticipant"
                                            data-can-change="{{ perms.project.change_participant }}"
                                            data-can-delete="{{ perms.project.delete_participant }}"
                                            >
                                                {% trans 'Action' %}
                                            </th>
                                            {% endif %}
                                        </tr>
                                    </thead>
                                    <tbody>

                                    </tbody>
                                </table>
                            </div>
                        </div>


                    </div>
                </div>
                
                
            </div> <!-- container # 1-->
        </div>
    </div>
</div>

<!-- ######################################    MILESTONES PANEL ############################################### -->

<div class="panel-hidden panel-visible" id="panel-project-milestone" style="display: block;">
    <div id='detail-panels'> 
        <div class="panel" id="panel-project-fund1" style="display: block;">

            <div class="panel-heading">
                <div class="d-flex flex-wrap">
                    <h4>{% trans 'project Milestones' %}</h4>
                    <span class="flex" style="flex-grow: 1;"></span>   
                
                    <div class="btn-group" role="group">
    
                        {% if perms.endpoints.add_milestones %}
                        <button type="button" class="btn btn-secondary" id="add_milestones" title="Add Item" data-pjPk="{{ project.pk }}" data-form-url="{% url 'create_project_milestones' project=project.pk %}" >
                            <span class='fa fas fa-plus'></span>
                        </button>
                        {% endif %}
                    </div>             
                </div>
            </div>
            <div class="panel-content">
                <div class="row" style=" padding-top: 5px;">
                    <div class="col">
                        <div class="card" id="milestones_project_list">
                            {% include 'endpoints/milestones_table.html' with datatype="project" %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ######################################    FUND PANEL ############################################### -->
<div class="panel-hidden panel-visible" id="panel-project-fund" style="display: block;">
    <div id='detail-panels'> 
        <div class="panel" id="panel-project-fund1" style="display: block;">

            <div class="panel-heading">
                <div class="d-flex flex-wrap">
                    <h4>{% trans 'project Funds Overview' %}</h4>
                    <span class="flex" style="flex-grow: 1;"></span>                
                </div>
            </div>
            <div class="panel-content">
                <div class="row" style=" padding-top: 5px;">
                    <div class="col">
                        <div class="card" id="fund_project_overview_detail">
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id='detail-panels'> 
        <div class="panel" id="panel-project-fund2" style="display: block;">

            <div class="panel-heading">
                <div class="d-flex flex-wrap">
                    <h4>{% trans 'Funds' %}</h4>
                    <span class="flex" style="flex-grow: 1;"></span>                
                </div>
            </div>
            <div class="panel-content">
                <div class="row" style=" padding-top: 5px;">
                    <div class="col">
                        <div class="card">
                            <div class="row-header">
                                <div class="d-flex flex-wrap subheading">
                                    <h4><i class="fas fa-money-bills"></i>  {% trans 'Fund' %} : <i class="super-small">{{ project }}</i></h4> 
                                    <span class="flex" style="flex-grow: 1;"></span>
                                    {% if perms.fund.add_fund %}
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-secondary" id="add_fund_temp" title="Add Item" data-projectpk="{{ project.pk }}" >
                                            <span class='fas fa-plus'></span>
                                        </button>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="row">
                                {% url 'api:project-funds' pk=project.pk as FundDataURL %}
                                {% include 'fund/fund_table.html' with datatype="project" dataURL=FundDataURL %}
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card" id="fund_overview">
                        </div>
                    </div>

                </div>
                <div class="row" style=" padding-top: 5px;">
                    <div class="col">
                        <div class="card">
                            <div class="card" id="fund_item_detail">
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card">
                            <div class="card" id="fund_expense_timepoint_detail">
                            </div>
                        </div>
                    </div>
                </div> 
            </div>
        </div>
    </div>
</div>
    <!-- ######################################    Contract ############################################### -->
<div id='detail-panels'>
    <div class="panel panel-hidden panel-visible" id="panel-project-contract" style="display: block;">

        <div class="panel-heading">
            <div class="d-flex flex-wrap">
                <h4>{% trans 'Contracts' %}</h4>
                <span class="flex" style="flex-grow: 1;"></span>                
            </div>
        </div>
        <div class="panel-content">

            <div class="row" style=" padding-top: 5px;">
                <div class="col">
                    <div class="card">
                        <div class="row-header">
                            <div class="d-flex flex-wrap subheading">
                                <h4><i class="fas fa-file-signature"></i>  {% trans 'Contract' %}</h4> 
                                <span class="flex" style="flex-grow: 1;"></span>
                                {% if perms.expense.add_contract %}
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-secondary" id="add_contract" title="Add Item" data-project="{{ project.pk }}" >
                                        <span class='fas fa-plus'></span>
                                    </button>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="row">
                        
                        
                        {% include 'expense/contract_table.html' with datatype="project" %}
                        
                        </div>
                    </div>
                </div>
            </div>
            <div class="row " style=" padding-top: 5px;">
                <div class="col">
                    <div class="card" id="contract_expense_detail">
                        
                    </div>
                </div>
            </div>
            
        </div>

    </div>
</div>

{{ request.user.id|json_script:"user_id" }}
{{ project.pk|json_script:"project_id" }}
{% endblock %}



{% block js_load %}
<script type='text/javascript' src="{% static 'js/project_single.js' %}"></script>
<script type='text/javascript' src="{% static 'js/tables/milestones_table.js' %}"></script>
<script type='text/javascript' src="{% static 'js/tables/contract_tables.js' %}"></script>
<script type='text/javascript' src="{% static 'js/tables/fund_tables.js' %}"></script>
<script type='text/javascript' src="{% static 'js/nav.js' %}"></script>
<script>
$(document).ready(function () {
    user_id = JSON.parse(document.getElementById('user_id').textContent);
    project_id = JSON.parse(document.getElementById('project_id').textContent);
    initProjectSingleView(user_id, project_id);

    initializeMilestoneTable(tableurl="{% url 'api:milestones-project' pj_pk=project.pk  %}", 'project', update_project)

    initializeContractsTable(tableurl="{% url 'api:project-contracts' pk=project.pk  %}", update_project);
    initializeFundTable(null, update_project)
    enableSidebar('project')


})
</script>

{% endblock %}

{% block js %}
{% endblock %}
